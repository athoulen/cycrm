<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="ImportMapper">
	<resultMap type="com.blueair.bean.CityAreaIds" id="CityAreaResultMap">
		<id column="city_id" property="cityId" jdbcType="INTEGER"/>
		<id column="area_id" property="areaId" jdbcType="INTEGER"/>
	</resultMap>

	<insert id="insertCustomers">
		INSERT INTO cy_customer_table(serial_code,customer_name,phone,deposit_bank,account_name,account_code,create_by,create_time)
		<foreach collection="list" item="item" open="values" separator=",">
		(#{item.serialCode},#{item.customerName},#{item.phone},#{item.depositBank},#{item.accountName},#{item.accountCode},"sysadmin",#{item.createTime})
		</foreach>
	</insert>
	
	<insert id="insertHospital">
		INSERT INTO cy_hospital_table(hospital_name,type,area_id,city_id,create_by,create_time)
		<foreach collection="list" item="item" open="values" separator=",">
		(#{item.hospitalName},#{item.type},#{item.zoneId},#{item.cityId},"sysadmin",#{item.createTime})
		</foreach>
	</insert>
	
	<insert id="insertProduct">
		INSERT INTO cy_product_table(product_name,product_norms,product_price,manufacture,bid_price,promote_fee)
		<foreach collection="list" item="item" open="values" separator=",">
		(#{item.productName},#{item.productNorms},#{item.productPrice},#{item.manufacture},#{item.bidPrice},#{item.promoteFee})
		</foreach>
	</insert>
	
	<insert id="insertCusProtocol">
		INSERT INTO cy_customer_protocol_table(protocol_code,customer_id,area_id,city_id,upper_merchan,lower_merchan,hospital_id,product_id,promotion_expense,bail,switch_expense,switch_standard,switch_amount,rebate_period,rebate_payer,rebate,is_honour,protocol_start,protocol_end,type,is_valid,create_by,create_time)
		<foreach collection="list" item="item" open="values" separator=",">
			<foreach collection="item.hospitals" item="obj" separator=",">
				<if test="obj!=null">
				(#{item.protocolCode},#{item.customerId},#{item.zoneId},#{item.cityId},#{item.upperMerchan},#{item.lowerMerchan},#{obj},#{item.productId},#{item.promotionExpense},#{item.bail},#{item.switchExpense},#{item.switchStandard},#{item.switchAmount},#{item.rebatePeriod},#{item.rebatePayer},#{item.rebate},#{item.isHonour},#{item.startTime},#{item.endTime},#{item.type},#{item.isValid},#{item.createBy},#{item.createTime})
				</if>
			</foreach>
		</foreach>
	</insert>
	
	<insert id="insertMerchan">
		INSERT INTO cy_merchandiser_table(name,class_type,create_by,create_time)
		<foreach collection="list" item="item" open="values" separator=",">
		(#{item.name},#{item.classType},"sysadmin",#{createTime})
		</foreach>
	</insert>
	
	<select id="queryForCustomerId" resultType="Integer">
		SELECT customer_id FROM cy_customer_table 
		WHERE serial_code=#{protocolCode} AND customer_name=#{customerName}
	</select>
	
	<select id="queryForHospitalId" resultType="Integer">
		SELECT hospital_id FROM cy_hospital_table WHERE #{hospitalName} LIKE CONCAT("%",hospital_name,"%") limit 1
	</select>
	
	<select id="queryForHospitals" resultType="Integer">
		SELECT hospital_id FROM cy_hospital_table WHERE 
		#{hospitalName} LIKE CONCAT("%",hospital_name,"%")
	</select>
	
	<select id="queryForProductId" resultType="Integer">
		SELECT product_id FROM cy_product_table 
		WHERE product_name=#{productName} AND product_norms=#{productNorms} 
		AND manufacture=#{manufacture}
	</select>
	
	<select id="queryForMerchanId" resultType="Integer">
		SELECT merch_id FROM cy_merchandiser_table WHERE #{merchanStr} like CONCAT("%",name,"%") limit 1
	</select>
	
	<select id="queryForAreaCity" resultMap="CityAreaResultMap">
		SELECT city_id,area_id from cy_city_info_table where city_name=#{cityStr}
	</select>
</mapper>